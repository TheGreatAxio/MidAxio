<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Set New Password - MidAxio</title>
    <link rel="stylesheet" href="/css/style.css">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1913229720945156" crossorigin="anonymous"></script>
</head>
<body>
<nav class="global-nav"></nav>
<aside class="side-sidebar"></aside>

<main class="main-container">
    <div class="auth-container">
        <h1>New Password</h1>
        <form id="resetForm">
            <input type="password" id="pass1" placeholder="New Password" required
                   style="width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box;">

            <input type="password" id="pass2" placeholder="Confirm New Password" required
                   style="width: 100%; padding: 10px; margin: 10px 0; background: #222; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box;">

            <button type="submit" class="btn"
                    style="width: 100%; padding: 10px; background: #4169e1; color: white; border: none; border-radius: 4px; cursor: pointer;">Update Password</button>
        </form>
        <div id="message" style="margin-top: 15px;"></div>
    </div>
</main>

<footer class="ad-footer"></footer>

<script src="/js/script.js"></script>
<script>
    document.getElementById('resetForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const p1 = document.getElementById('pass1').value;
        const p2 = document.getElementById('pass2').value;
        const msg = document.getElementById('message');
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');

        if (p1 === null || p1.trim().length === 0) {
            msg.style.color = "red";
            msg.innerText = "Password cannot be empty.";
            return;
        }

        if (p1 !== p2) {
            msg.style.color = "red";
            msg.innerText = "Passwords do not match.";
            return;
        }

        try {
            const response = await fetch('https://api.axioscomputers.com/api/v1/auth/reset-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    token: token,
                    newPassword: p1
                })
            });

            if (response.ok) {
                msg.style.color = "lightgreen";
                msg.innerText = "Password updated! Redirecting to login...";
                setTimeout(() => { window.location.href = '/login'; }, 2000);
            } else {
                const errorText = await response.text();
                msg.style.color = "red";
                msg.innerText = errorText || "Link expired or invalid.";
            }
        } catch (error) {
            msg.innerText = "Error connecting to server.";
        }
    });
</script>
</body>
</html>